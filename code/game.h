#pragma once

#include "base.h"
//#include "base.cpp"

#define HV_RED   (Vec3){1.0f, 0.0f, 0.0f}
#define HV_BLUE  (Vec3){0.0f, 0.0f, 1.0f}
#define HV_GREEN (Vec3){0.0f, 1.0f, 0.0f}
#define HV_BLACK (Vec3){0.0f, 0.0f, 0.0f}



struct Sprite {
    Vec2 pos;
    Vec2 size;
    Vec2 aoffset, asize;
    Vec3 color;
};

#define MAX_SPRITES 8192

struct Glyph {
	Vec4 rect;
	u8 value;
	int offset_x;
	int offset_y;
	int advance_x;
};

struct Texture{
	Vec4 rect;
	// These offsets tell you how much space there is between the rect and the edge of the original document.
	// The atlas is tightly packed, so empty pixels are removed. This can be especially apparent in animations where
	// frames can have different offsets due to different amount of empty pixels around the frames.
	// In many cases you need to add {offset_left, offset_top} to your position. But if you are
	// flipping a texture, then you might need offset_bottom or offset_right.
	f32 offset_top;
	f32 offset_right;
	f32 offset_bottom;
	f32 offset_left;
	Vec2 document_size;
	f32 duration;
};

enum TextureName {
	Body_Template0,
	Body_Template1,
	Body_Template2,
	Body_Template3,
	Body_Template4,
	Body_Template5,
	Body_Template6,
	Body_Template7,
	Body_Template8,
	Body_Template9,
	Body_Template10,
	Body_Template11,
	Body_Template12,
	Body_Template13,
	Body_Template14,
	Body_Template15,
	Body_Template16,
	Body_Template17,
	Body_Template18,
	Body_Template19,
	Body_Template20,
	Body_Template21,
	Body_Template22,
	Body_Template23,
	Body_Template24,
	Body_Template25,
	Body_Template26,
	Body_Template27,
	Body_Template28,
	Body_Template29,
	Body_Template30,
	Body_Template31,
	Body_Template32,
	Body_Template33,
	Body_Template34,
	Body_Template35,
	Body_Template36,
	Body_Template37,
	Body_Template38,
	Body_Template39,
	Body_Template40,
	Body_Template41,
	Body_Template42,
	Body_Template43,
	Body_Template44,
	Body_Template45,
	Body_Template46,
	Body_Template47,
	Body_Template48,
	Body_Template49,
	Wall,
};

struct Animation {
	TextureName first_frame;
	TextureName last_frame;
};

enum AnimationName {
	Body_Template_Walk,
	Body_Template_Flat_Jump,
	Body_Template_Run,
	Body_Template_Idle,
	Body_Template_Jump,
};

struct SpriteBatch {
    Sprite *sprite;
    u32 count;
};


struct GameState {
    b32 flip;
    Vec2 pos;
    Vec2 vel;
    Animation animation;
    f32 animatet;
    usize animation_index;
    usize animate_index;
    u32 *level;
    int startx, starty;
};

struct ButtonState {
    b32 ended_down;
    int htransition_count;
};

enum HVJoystick {
    HV_Keyboard,
    HV_Joystick1,
    HV_Joystick2,
    HV_Joystick3,
    HV_Joystick_Count,
};


struct ControllerInput {
    b32 is_analog;
    union {
        ButtonState buttons[14];
        struct {
            ButtonState move_up;
            ButtonState move_down;
            ButtonState move_right;
            ButtonState move_left;
            ButtonState action_up;
            ButtonState action_down;
            ButtonState action_left;
            ButtonState action_right;

            ButtonState start;
            ButtonState back;

            ButtonState l1trigger;
            ButtonState r1trigger;
            ButtonState l2trigger;
            ButtonState r2trigger;
        };
    };

    Vec2 avg;

};

struct GameInput {
    ControllerInput cinput[HV_Joystick_Count];
};

struct Memory {
    b32 is_init;
    Arena *temp;
    Arena *transient;
    Arena *permanent;

    Console *log;
    SpriteBatch *sb;

    GameState *state;
    GameInput *input;
\
    f32 dt;
};

//#include "gl_renderer.h"
//#include "gl_renderer.cpp"

#define UPDATE_FUNC(name) void name(Memory *m)
typedef UPDATE_FUNC(UpdateP);


/*
Glyph glyphs[] = {
	{ {35.f,  29.f, 18.f, 25.f}, 'A',  0,  0,  24},
	{ {415.f, 28.f, 18.f, 25.f}, 'B',  0,  0,  24},
	{ {295.f, 28.f, 18.f, 25.f}, 'C',  0,  0,  24},
	{ {235.f, 28.f, 18.f, 25.f}, 'D',  0,  0,  24},
	{ {406.f, 1.f,  18.f, 25.f}, 'E',  0,  0,  24},
	{ {166.f, 1.f,  18.f, 25.f}, 'F',  0,  0,  24},
	{ {286.f, 1.f,  18.f, 25.f}, 'G',  0,  0,  24},
	{ {115.f, 28.f, 18.f, 25.f}, 'H',  0,  0,  24},
	{ {495.f, 28.f, 11.f, 25.f}, 'I',  0,  0,  17},
	{ {94.f,  29.f, 11.f, 25.f}, 'J',  0,  0,  17},
	{ {186.f, 1.f,  18.f, 25.f}, 'K',  0,  0,  24},
	{ {206.f, 1.f,  18.f, 25.f}, 'L',  0,  0,  24},
	{ {226.f, 1.f,  18.f, 25.f}, 'M',  0,  0,  24},
	{ {246.f, 1.f,  18.f, 25.f}, 'N',  0,  0,  24},
	{ {266.f, 1.f,  18.f, 25.f}, 'O',  0,  0,  24},
	{ {426.f, 1.f,  18.f, 25.f}, 'P',  0,  0,  24},
	{ {306.f, 1.f,  18.f, 25.f}, 'Q',  0,  0,  24},
	{ {326.f, 1.f,  18.f, 25.f}, 'R',  0,  0,  24},
	{ {346.f, 1.f,  18.f, 25.f}, 'S',  0,  0,  24},
	{ {366.f, 1.f,  18.f, 25.f}, 'T',  0,  0,  24},
	{ {386.f, 1.f,  18.f, 25.f}, 'U',  0,  0,  24},
	{ {435.f, 28.f, 18.f, 25.f}, 'V',  0,  0,  24},
	{ {115.f, 1.f,  25.f, 25.f}, 'W',  0,  0,  32},
	{ {446.f, 1.f,  18.f, 25.f}, 'X',  0,  0,  24},
	{ {466.f, 1.f,  18.f, 25.f}, 'Y',  0,  0,  24},
	{ {486.f, 1.f,  18.f, 25.f}, 'Z',  0,  0,  24},
	{ {307.f, 55.f, 18.f, 18.f}, 'a',  0,  6,  24},
	{ {135.f, 28.f, 18.f, 25.f}, 'b',  0,  0,  24},
	{ {267.f, 55.f, 18.f, 18.f}, 'c',  0,  6,  24},
	{ {175.f, 28.f, 18.f, 25.f}, 'd',  0,  0,  24},
	{ {247.f, 55.f, 18.f, 18.f}, 'e',  0,  6,  24},
	{ {68.f,  29.f, 11.f, 25.f}, 'f',  0,  0,  17},
	{ {55.f,  1.f,  18.f, 26.f}, 'g',  0,  6,  24},
	{ {255.f, 28.f, 18.f, 25.f}, 'h',  0,  0,  24},
	{ {1.f,   36.f, 4.f,  25.f}, 'i',  0,  0,  10},
	{ {1.f,   1.f,  12.f, 33.f}, 'j',  -4, 0,  14},
	{ {315.f, 28.f, 18.f, 25.f}, 'k',  0,  0,  24},
	{ {7.f,   36.f, 4.f,  25.f}, 'l',  0,  0,  10},
	{ {140.f, 55.f, 25.f, 18.f}, 'm',  0,  6,  32},
	{ {167.f, 55.f, 18.f, 18.f}, 'n',  0,  6,  24},
	{ {187.f, 55.f, 18.f, 18.f}, 'o',  0,  6,  24},
	{ {75.f,  1.f,  18.f, 26.f}, 'p',  0,  6,  24},
	{ {35.f,  1.f,  18.f, 26.f}, 'q',  0,  6,  24},
	{ {69.f,  56.f, 11.f, 18.f}, 'r',  0,  6,  17},
	{ {227.f, 55.f, 18.f, 18.f}, 's',  0,  6,  24},
	{ {81.f,  29.f, 11.f, 25.f}, 't',  0,  0,  17},
	{ {347.f, 55.f, 18.f, 18.f}, 'u',  0,  6,  24},
	{ {207.f, 55.f, 18.f, 18.f}, 'v',  0,  6,  24},
	{ {113.f, 55.f, 25.f, 18.f}, 'w',  0,  6,  32},
	{ {327.f, 55.f, 18.f, 18.f}, 'x',  0,  6,  24},
	{ {95.f,  1.f,  18.f, 26.f}, 'y',  0,  6,  24},
	{ {287.f, 55.f, 18.f, 18.f}, 'z',  0,  6,  24},
	{ {55.f,  29.f, 11.f, 25.f}, '1',  0,  0,  17},
	{ {475.f, 28.f, 18.f, 25.f}, '2',  0,  0,  24},
	{ {455.f, 28.f, 18.f, 25.f}, '3',  0,  0,  24},
	{ {395.f, 28.f, 18.f, 25.f}, '4',  0,  0,  24},
	{ {375.f, 28.f, 18.f, 25.f}, '5',  0,  0,  24},
	{ {355.f, 28.f, 18.f, 25.f}, '6',  0,  0,  24},
	{ {335.f, 28.f, 18.f, 25.f}, '7',  0,  0,  24},
	{ {275.f, 28.f, 18.f, 25.f}, '8',  0,  0,  24},
	{ {215.f, 28.f, 18.f, 25.f}, '9',  0,  0,  24},
	{ {195.f, 28.f, 18.f, 25.f}, '0',  0,  0,  24},
	{ {155.f, 28.f, 18.f, 25.f}, '?',  0,  0,  24},
	{ {107.f, 29.f, 4.f,  25.f}, '!',  0,  0,  10},
	{ {142.f, 1.f,  22.f, 25.f}, '&',  0,  0,  28},
	{ {295.f, 96.f, 6.f,  4.f }, '.',  0,  16, 14},
	{ {274.f, 94.f, 8.f,  12.f}, ',',  0,  16, 14},
	{ {305.f, 94.f, 18.f, 5.f }, '_',  0,  27, 24},
	{ {82.f,  56.f, 8.f,  18.f}, ':',  0,  6,  14},
	{ {15.f,  1.f,  8.f,  33.f}, '[',  0,  0,  14},
	{ {25.f,  1.f,  8.f,  33.f}, ']',  0,  0,  14},
	{ {325.f, 94.f, 11.f, 5.f }, '-',  0,  9,  17},
	{ {13.f,  36.f, 18.f, 19.f}, '+',  0,  2,  24},
}; */

Glyph atlas_glyphs[] = {
	{ {1, 1, 17, 24},  'A',   0,  3,  20},
	{ {20, 1, 17, 24},  'B',  0,  3,  20},
	{ {39, 1, 17, 24},  'C',  0,  3,  20},
	{ {58, 1, 17, 24},  'D',  0,  3,  20},
	{ {77, 1, 17, 24},  'E',  0,  3,  20},
	{ {96, 1, 17, 24},  'F',  0,  3,  20},
	{ {115, 1, 17, 24},  'G',  0,  3,  20},
	{ {134, 1, 17, 24},  'H',  0,  3,  20},
	{ {328, 27, 11, 24},  'I',  3,  3,  20},
	{ {172, 1, 17, 24},  'J',  0,  3,  20},
	{ {191, 1, 17, 24},  'K',  0,  3,  20},
	{ {210, 1, 17, 24},  'L',  0,  3,  20},
	{ {229, 1, 17, 24},  'M',  0,  3,  20},
	{ {248, 1, 17, 24},  'N',  0,  3,  20},
	{ {267, 1, 17, 24},  'O',  0,  3,  20},
	{ {286, 1, 17, 24},  'P',  0,  3,  20},
	{ {305, 1, 17, 24},  'Q',  0,  3,  20},
	{ {324, 1, 17, 24},  'R',  0,  3,  20},
	{ {343, 1, 17, 24},  'S',  0,  3,  20},
	{ {362, 1, 17, 24},  'T',  0,  3,  20},
	{ {381, 1, 17, 24},  'U',  0,  3,  20},
	{ {400, 1, 17, 24},  'V',  0,  3,  20},
	{ {419, 1, 17, 24},  'W',  0,  3,  20},
	{ {438, 1, 17, 24},  'X',  0,  3,  20},
	{ {457, 1, 17, 24},  'Y',  0,  3,  20},
	{ {476, 1, 17, 24},  'Z',  0,  3,  20},
	{ {394, 67, 17, 17},  'a',  0,  10,  20},
	{ {20, 27, 17, 24},  'b',  0,  3,  20},
	{ {345, 53, 17, 17},  'c',  0,  10,  20},
	{ {58, 27, 17, 24},  'd',  0,  3,  20},
	{ {307, 53, 17, 17},  'e',  0,  10,  20},
	{ {96, 27, 17, 24},  'f',  0,  3,  20},
	{ {385, 27, 17, 21},  'g',  0,  6,  20},
	{ {134, 27, 17, 24},  'h',  0,  3,  20},
	{ {302, 27, 11, 24},  'i',  3,  3,  20},
	{ {495, 1, 14, 24},  'j',  0,  3,  20},
	{ {286, 27, 14, 24},  'k',  0,  3,  20},
	{ {341, 27, 11, 24},  'l',  3,  3,  20},
	{ {288, 53, 17, 17},  'm',  0,  10,  20},
	{ {250, 53, 17, 17},  'n',  0,  10,  20},
	{ {77, 72, 17, 17},  'o',  0,  10,  20},
	{ {470, 67, 17, 17},  'p',  0,  10,  20},
	{ {432, 67, 17, 17},  'q',  0,  10,  20},
	{ {451, 67, 17, 17},  'r',  0,  10,  20},
	{ {96, 72, 17, 17},  's',  0,  10,  20},
	{ {267, 27, 17, 24},  't',  0,  3,  20},
	{ {58, 72, 17, 17},  'u',  0,  10,  20},
	{ {39, 72, 17, 17},  'v',  0,  10,  20},
	{ {489, 67, 17, 17},  'w',  0,  10,  20},
	{ {413, 67, 17, 17},  'x',  0,  10,  20},
	{ {326, 53, 17, 17},  'y',  0,  10,  20},
	{ {269, 53, 17, 17},  'z',  0,  10,  20},
	{ {354, 27, 11, 24},  '1',  3,  3,  20},
	{ {248, 27, 17, 24},  '2',  0,  3,  20},
	{ {229, 27, 17, 24},  '3',  0,  3,  20},
	{ {210, 27, 17, 24},  '4',  0,  3,  20},
	{ {191, 27, 17, 24},  '5',  0,  3,  20},
	{ {172, 27, 17, 24},  '6',  0,  3,  20},
	{ {153, 27, 17, 24},  '7',  0,  3,  20},
	{ {115, 27, 17, 24},  '8',  0,  3,  20},
	{ {77, 27, 17, 24},  '9',  0,  3,  20},
	{ {39, 27, 17, 24},  '0',  0,  3,  20},
	{ {1, 27, 17, 24},  '?',  0,  3,  20},
	{ {380, 27, 3, 24},  '!',  7,  3,  20},
	{ {153, 1, 17, 24},  '&',  0,  3,  20},
	{ {366, 90, 7, 7},  '.',  3,  20,  20},
	{ {346, 90, 7, 10},  ',',  3,  17,  20},
	{ {1, 91, 17, 4},  '_',  0,  23,  20},
	{ {385, 50, 7, 18},  ':',  3,  6,  20},
	{ {315, 27, 11, 24},  '[',  3,  3,  20},
	{ {367, 27, 11, 24},  ']',  3,  3,  20},
	{ {20, 91, 17, 4},  '-',  0,  13,  20},
	{ {442, 27, 17, 18},  '+',  0,  6,  20},
};

Glyph glyphs[] =  {
	{ {96.f,  90.f, 4.f,  4.f }, ' ',  0,  0,  10},  //32  0
	{ {107.f, 29.f, 4.f,  25.f}, '!',  0,  0,  10},   //33  1
	{ {155.f, 28.f, 18.f, 25.f}, '?',  0,  0,  24},  //34  2
	{ {155.f, 28.f, 18.f, 25.f}, '?',  0,  0,  24},  //35  3
	{ {155.f, 28.f, 18.f, 25.f}, '?',  0,  0,  24},  //36  4
	{ {155.f, 28.f, 18.f, 25.f}, '?',  0,  0,  24},  //37  5
	{ {142.f, 1.f,  22.f, 25.f}, '&',  0,  0,  28},  //38  6
	{ {274.f, 94.f, 8.f,  12.f}, ',',  0,  16, 14},  //39  7
	{ {15.f,  1.f,  8.f,  33.f}, '[',  0,  0,  14},  //40  8
	{ {25.f,  1.f,  8.f,  33.f}, ']',  0,  0,  14},  //41  9
	{ {13.f,  36.f, 18.f, 19.f}, '+',  0,  2,  24},  //42  0
	{ {13.f,  36.f, 18.f, 19.f}, '+',  0,  2,  24},  //43  10
	{ {274.f, 94.f, 8.f,  12.f}, ',',  0,  16, 14},  //44  11
	{ {325.f, 94.f, 11.f, 5.f }, '-',  0,  9,  17},  //45  12
	{ {354.f, 89.f, 4.f,  4.f }, '.',  3, 20,  20},  //46  13
	{ {107.f, 29.f, 4.f,  25.f}, ' ',  0,  0,  10},  //47  14
	{ {39.f, 27.f, 17.f,  24.f}, '0',  0,  3,  20},
	{ {354.f, 27.f, 11.f, 24.f}, '1',  3,  3,  20},
	{ {248.f, 27.f, 17.f, 24.f}, '2',  0,  3,  20},
	{ {229.f, 27.f, 17.f, 24.f}, '3',  0,  3,  20},
	{ {210.f, 27.f, 17.f, 24.f}, '4',  0,  3,  20},
	{ {191.f, 27.f, 17.f, 24.f}, '5',  0,  3,  20},
	{ {172.f, 27.f, 17.f, 24.f}, '6',  0,  3,  20},
	{ {153.f, 27.f, 17.f, 24.f}, '7',  0,  3,  20},
	{ {115.f, 27.f, 17.f, 24.f}, '8',  0,  3,  20},
	{ {77.f, 27.f, 17.f,  24.f}, '9',  0,  3,  20},
	{ {82.f,  56.f, 8.f,  18.f}, ':',  0,  6,  14},  //58  25
	{ {82.f,  56.f, 8.f,  18.f}, ':',  0,  6,  14},  //59  26
	{ {82.f,  56.f, 8.f,  18.f}, ':',  0,  6,  14},  //60  27
	{ {82.f,  56.f, 8.f,  18.f}, ':',  0,  6,  14},  //61  28
	{ {82.f,  56.f, 8.f,  18.f}, ':',  0,  6,  14},  //62  29
	{ {155.f, 28.f, 18.f, 25.f}, '?',  0,  0,  24},  //63  30
	{ {155.f, 28.f, 18.f, 25.f}, '?',  0,  0,  24},  //64  31
	{ {1.f,   1.f,  17.f, 24.f}, 'A',  0,  3,  20},
	{ {20.f,  1.f,  17.f, 24.f}, 'B',  0,  3,  20},
	{ {39.f,  1.f,  17.f, 24.f}, 'C',  0,  3,  20},
	{ {58.f,  1.f,  17.f, 24.f}, 'D',  0,  3,  20},
	{ {77.f,  1.f,  17.f, 24.f}, 'E',  0,  3,  20},
	{ {96.f,  1.f,  17.f, 24.f}, 'F',  0,  3,  20},
	{ {115.f, 1.f,  17.f, 24.f}, 'G',  0,  3,  20},
	{ {134.f, 1.f,  17.f, 24.f}, 'H',  0,  3,  20},
	{ {328.f, 27.f, 11.f, 24.f}, 'I',  3,  3,  20},
	{ {172.f, 1.f,  17.f, 24.f}, 'J',  0,  3,  20},
	{ {191.f, 1.f,  17.f, 24.f}, 'K',  0,  3,  20},
	{ {210.f, 1.f,  17.f, 24.f}, 'L',  0,  3,  20},
	{ {229.f, 1.f,  17.f, 24.f}, 'M',  0,  3,  20},
	{ {248.f, 1.f,  17.f, 24.f}, 'N',  0,  3,  20},
	{ {267.f, 1.f,  17.f, 24.f}, 'O',  0,  3,  20},
	{ {286.f, 1.f,  17.f, 24.f}, 'P',  0,  3,  20},
	{ {305.f, 1.f,  17.f, 24.f}, 'Q',  0,  3,  20},
	{ {324.f, 1.f,  17.f, 24.f}, 'R',  0,  3,  20},
	{ {343.f, 1.f,  17.f, 24.f}, 'S',  0,  3,  20},
	{ {362.f, 1.f,  17.f, 24.f}, 'T',  0,  3,  20},
	{ {381.f, 1.f,  17.f, 24.f}, 'U',  0,  3,  20},
	{ {400.f, 1.f,  17.f, 24.f}, 'V',  0,  3,  20},
	{ {419.f, 1.f,  17.f, 24.f}, 'W',  0,  3,  20},
	{ {438.f, 1.f,  17.f, 24.f}, 'X',  0,  3,  20},
	{ {457.f, 1.f,  17.f, 24.f}, 'Y',  0,  3,  20},
	{ {476.f, 1.f,  17.f, 24.f}, 'Z',  0,  3,  20},
	{ {15.f,  1.f,  8.f,  33.f}, '[',  0,  0,  14},  //91
	{ {25.f,  1.f,  8.f,  33.f}, ']',  0,  0,  14},  //92
	{ {25.f,  1.f,  8.f,  33.f}, ']',  0,  0,  14},  //93
	{ {305.f, 94.f, 18.f, 5.f }, '_',  0,  27, 24},  //94
	{ {305.f, 94.f, 18.f, 5.f }, '_',  0,  27, 24},  //95
	{ {305.f, 94.f, 18.f, 5.f }, '_',  0,  27, 24},  //96
	{ {394.f, 67.f, 17.f, 17.f}, 'a',  0,  10, 20},
	{ {20.f, 27.f, 17.f,  24.f}, 'b',  0,  3,  20},
	{ {345.f, 53.f, 17.f, 17.f}, 'c',  0,  10, 20},
	{ {58.f, 27.f, 17.f,  24.f}, 'd',  0,  3,  20},
	{ {307.f, 53.f, 17.f, 17.f}, 'e',  0,  10, 20},
	{ {96.f, 27.f, 17.f,  24.f}, 'f',  0,  3,  20},
	{ {385.f, 27.f, 17.f, 21.f}, 'g',  0,  6,  20},
	{ {134.f, 27.f, 17.f, 24.f}, 'h',  0,  3,  20},
	{ {302.f, 27.f, 11.f, 24.f}, 'i',  3,  3,  20},
	{ {495.f, 1.f, 14.f,  24.f}, 'j',  0,  3,  20},
	{ {286.f, 27.f, 14.f, 24.f}, 'k',  0,  3,  20},
	{ {341.f, 27.f, 11.f, 24.f}, 'l',  3,  3,  20},
	{ {288.f, 53.f, 17.f, 17.f}, 'm',  0,  10, 20},
	{ {250.f, 53.f, 17.f, 17.f}, 'n',  0,  10, 20},
	{ {77.f, 72.f, 17.f,  17.f}, 'o',  0,  10, 20},
	{ {470.f, 67.f, 17.f, 17.f}, 'p',  0,  10, 20},
	{ {432.f, 67.f, 17.f, 17.f}, 'q',  0,  10, 20},
	{ {451.f, 67.f, 17.f, 17.f}, 'r',  0,  10, 20},
	{ {96.f, 72.f, 17.f,  17.f}, 's',  0,  10, 20},
	{ {267.f, 27.f, 17.f, 24.f}, 't',  0,  3,  20},
	{ {58.f, 72.f, 17.f,  17.f}, 'u',  0,  10, 20},
	{ {39.f, 72.f, 17.f,  17.f}, 'v',  0,  10, 20},
	{ {489.f, 67.f, 17.f, 17.f}, 'w',  0,  10, 20},
	{ {413.f, 67.f, 17.f, 17.f}, 'x',  0,  10, 20},
	{ {326.f, 53.f, 17.f, 17.f}, 'y',  0,  10, 20},
	{ {269.f, 53.f, 17.f, 17.f}, 'z',  0,  10, 20},
};

Texture textures[] = {
	{ {0.f,   52.f, 27.f, 18.f},  46,  13,  0,  24,  {64.f, 64.f},  0.100f},
	{ {55.f,  52.f, 25.f, 18.f},  46,  15,  0,  24,  {64.f, 64.f},  0.100f},
	{ {81.f,  52.f, 23.f, 18.f},  46,  16,  0,  25,  {64.f, 64.f},  0.100f},
	{ {224.f, 71.f, 22.f, 17.f},  47,  17,  0,  25,  {64.f, 64.f},  0.100f},
	{ {269.f, 71.f, 21.f, 17.f},  47,  18,  0,  25,  {64.f, 64.f},  0.100f},
	{ {417.f, 85.f, 19.f, 17.f},  47,  20,  0,  25,  {64.f, 64.f},  0.100f},
	{ {132.f, 71.f, 17.f, 18.f},  46,  22,  0,  25,  {64.f, 64.f},  0.100f},
	{ {363.f, 52.f, 18.f, 18.f},  46,  21,  0,  25,  {64.f, 64.f},  0.100f},
	{ {149.f, 52.f, 19.f, 18.f},  46,  20,  0,  25,  {64.f, 64.f},  0.100f},
	{ {355.f, 71.f, 20.f, 17.f},  47,  19,  0,  25,  {64.f, 64.f},  0.100f},
	{ {291.f, 71.f, 21.f, 17.f},  47,  18,  0,  25,  {64.f, 64.f},  0.100f},
	{ {200.f, 71.f, 23.f, 17.f},  47,  16,  0,  25,  {64.f, 64.f},  0.100f},
	{ {209.f, 52.f, 19.f, 18.f},  46,  20,  0,  25,  {64.f, 64.f},  0.100f},
	{ {437.f, 85.f, 17.f, 17.f},  47,  22,  0,  25,  {64.f, 64.f},  0.100f},
	{ {233.f, 89.f, 17.f, 16.f},  48,  24,  0,  23,  {64.f, 64.f},  0.100f},
	{ {19.f,  71.f, 18.f, 18.f},  46,  21,  0,  25,  {64.f, 64.f},  0.100f},
	{ {403.f, 26.f, 18.f, 19.f},  45,  21,  0,  25,  {64.f, 64.f},  0.100f},
	{ {460.f, 26.f, 17.f, 19.f},  45,  22,  0,  25,  {64.f, 64.f},  0.100f},
	{ {478.f, 26.f, 17.f, 19.f},  45,  24,  0,  23,  {64.f, 64.f},  0.100f},
	{ {403.f, 46.f, 17.f, 19.f},  45,  25,  0,  22,  {64.f, 64.f},  0.100f},
	{ {421.f, 46.f, 17.f, 19.f},  45,  25,  0,  22,  {64.f, 64.f},  0.100f},
	{ {114.f, 71.f, 17.f, 18.f},  46,  25,  0,  22,  {64.f, 64.f},  0.100f},
	{ {269.f, 89.f, 17.f, 16.f},  48,  24,  0,  23,  {64.f, 64.f},  0.100f},
	{ {169.f, 52.f, 19.f, 18.f},  46,  20,  0,  25,  {64.f, 64.f},  0.100f},
	{ {168.f, 71.f, 31.f, 17.f},  44,  12,  3,  21,  {64.f, 64.f},  0.100f},
	{ {473.f, 85.f, 32.f, 16.f},  45,  11,  3,  21,  {64.f, 64.f},  0.100f},
	{ {28.f,  52.f, 26.f, 18.f},  46,  17,  0,  21,  {64.f, 64.f},  0.100f},
	{ {247.f, 71.f, 21.f, 17.f},  47,  18,  0,  25,  {64.f, 64.f},  0.100f},
	{ {313.f, 71.f, 20.f, 17.f},  44,  23,  3,  21,  {64.f, 64.f},  0.100f},
	{ {213.f, 89.f, 19.f, 16.f},  45,  24,  3,  21,  {64.f, 64.f},  0.100f},
	{ {105.f, 52.f, 22.f, 18.f},  46,  21,  0,  21,  {64.f, 64.f},  0.100f},
	{ {397.f, 85.f, 19.f, 17.f},  47,  20,  0,  25,  {64.f, 64.f},  0.100f},
	{ {128.f, 52.f, 20.f, 18.f},  46,  19,  0,  25,  {64.f, 64.f},  0.100f},
	{ {334.f, 71.f, 20.f, 17.f},  47,  19,  0,  25,  {64.f, 64.f},  0.100f},
	{ {191.f, 89.f, 21.f, 16.f},  48,  19,  0,  24,  {64.f, 64.f},  0.100f},
	{ {322.f, 89.f, 22.f, 15.f},  49,  18,  0,  24,  {64.f, 64.f},  0.100f},
	{ {168.f, 89.f, 22.f, 16.f},  48,  18,  0,  24,  {64.f, 64.f},  0.100f},
	{ {376.f, 85.f, 20.f, 17.f},  47,  19,  0,  25,  {64.f, 64.f},  0.100f},
	{ {229.f, 52.f, 19.f, 18.f},  46,  20,  0,  25,  {64.f, 64.f},  0.100f},
	{ {455.f, 85.f, 17.f, 17.f},  47,  22,  0,  25,  {64.f, 64.f},  0.100f},
	{ {251.f, 89.f, 17.f, 16.f},  48,  24,  0,  23,  {64.f, 64.f},  0.100f},
	{ {0.f,   71.f, 18.f, 18.f},  46,  21,  0,  25,  {64.f, 64.f},  0.100f},
	{ {422.f, 26.f, 18.f, 19.f},  29,  21,  16, 25,  {64.f, 64.f},  0.100f},
	{ {475.f, 46.f, 17.f, 19.f},  25,  22,  20, 25,  {64.f, 64.f},  0.100f},
	{ {457.f, 46.f, 17.f, 19.f},  23,  24,  22, 23,  {64.f, 64.f},  0.100f},
	{ {493.f, 46.f, 17.f, 19.f},  25,  25,  20, 22,  {64.f, 64.f},  0.100f},
	{ {439.f, 46.f, 17.f, 19.f},  29,  25,  16, 22,  {64.f, 64.f},  0.100f},
	{ {150.f, 71.f, 17.f, 18.f},  46,  25,  0,  22,  {64.f, 64.f},  0.100f},
	{ {287.f, 89.f, 17.f, 16.f},  48,  24,  0,  23,  {64.f, 64.f},  0.100f},
	{ {189.f, 52.f, 19.f, 18.f},  46,  20,  0,  25,  {64.f, 64.f},  0.100f},
	{ {305.f, 89.f, 16.f, 16.f},  0,  112,  112, 0,  {128.f, 128.f},0.100f},
};

Animation animations[] =  {
	{ Body_Template0,  Body_Template11 },
	{ Body_Template12, Body_Template23 },
	{ Body_Template24, Body_Template31 },
	{ Body_Template32, Body_Template37 },
	{ Body_Template38, Body_Template49 },
};

function b32
was_pressed(ButtonState *state) {
	b32 result = ((state->htransition_count > 1) ||
	             ((state->htransition_count == 1) &&
	             ( state->ended_down)));
	return result;
}

function void
process_keyboard_message(ButtonState *new_state, b32 is_down) {
    if (new_state->ended_down != is_down) {
        new_state->ended_down = is_down;
        new_state->htransition_count++;
    }
}


#define LEVEL_WIDTH 20
#define LEVEL_HEIGHT 11

#define TILE_SIZE 64

u32 game_level5[LEVEL_HEIGHT * 2][LEVEL_WIDTH * 2] = {
	{1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,   1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
	{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,   1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
	{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,   1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
	{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1,   1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1},
	{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 2,   2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1},
	{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1,   1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
	{1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1,   1, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
	{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1,   1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
	{1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1,   1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
	{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,   1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
	{1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1,   1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1},

	{1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1,   1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1 },
	{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 2,   2, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1 },
	{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1,   1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1 },
	{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1,   1, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1 },
	{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1,   1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1 },
	{1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1,   1, 0, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0, 1 },
	{1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1,   1, 0, 1, 1, 1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1 },
	{1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1,   1, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 1, 0, 1 },
	{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1,   1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1 },
	{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,   1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1 },
	{1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,   1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1 },
};

#define GAME_LEVEL_WIDTH (LEVEL_WIDTH * 2)
#define GAME_LEVEL_HEIGHT (LEVEL_HEIGHT * 2)

#define CAMERA_FOLLOW_THRESHOLD_X 200  // pikseli od centra ekrana
#define CAMERA_FOLLOW_THRESHOLD_Y 150  // pikseli od centra ekrana
#define CAMERA_SMOOTH_FACTOR 0.1f      // brzina praÄ‡enja kamere (0-1)



